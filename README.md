# ä½“è‚²é€šè¯†æ•™å­¦ç³»ç»Ÿ

åŸºäºçŸ¥è¯†å›¾è°±å’ŒåŒæ™ºèƒ½ä½“è°ƒæ§çš„æ™ºèƒ½æ•™å­¦ç³»ç»Ÿï¼Œå®ç°ç»“æ„åŒ–çš„æ•™å­¦è·¯å¾„ç”Ÿæˆä¸è‡ªé€‚åº”å­¦ä¹ è°ƒæ§ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ—ºï¸ **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šä»æ•™å­¦ææ–™ä¸­è‡ªåŠ¨æŠ½å–ç»“æ„åŒ–çŸ¥è¯†ï¼Œæ„å»ºå¤šå±‚æ¬¡çš„è¯­ä¹‰ç½‘ç»œ
- ğŸ”— **ä»»åŠ¡é“¾ç”Ÿæˆ**ï¼šåŸºäºæ‹“æ‰‘æ’åºç”ŸæˆG-P-Fï¼ˆGuidance-Presentation-Feedbackï¼‰ä¸‰é˜¶æ®µæ•™å­¦ä»»åŠ¡é“¾
- ğŸ¤– **åŒæ™ºèƒ½ä½“è°ƒæ§**ï¼šGuiding Agentå’ŒStructural AgentååŒå·¥ä½œï¼Œå®ç°è‡ªé€‚åº”å­¦ä¹ è·¯å¾„è°ƒæ•´
- ğŸ“Š **å›¾å¢å¼ºRAG**ï¼šç»“åˆçŸ¥è¯†å›¾è°±æ£€ç´¢å’Œå‘é‡æ£€ç´¢ï¼Œç”Ÿæˆé«˜è´¨é‡æ•™å­¦å†…å®¹
- ğŸ“ **è¯æ®åŒ–æ—¥å¿—**ï¼šå…¨ç¨‹è®°å½•å­¦ä¹ è·¯å¾„å’Œè°ƒæ§å†³ç­–ï¼Œæ”¯æŒå¯å¤ç°å®éªŒ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŒ…å«5ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®æ¥å…¥ä¸è¯­ä¹‰åˆ‡åˆ†                      â”‚
â”‚              (data_processor.py)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  çŸ¥è¯†å›¾è°±æ„å»º                             â”‚
â”‚              (kg_builder.py)                            â”‚
â”‚  â€¢ ä¸‰å…ƒç»„æŠ½å–  â€¢ è§„èŒƒåŒ–å»é‡  â€¢ Neo4jé›†æˆ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä»»åŠ¡é“¾ç”Ÿæˆå™¨                              â”‚
â”‚         (task_chain_generator.py)                        â”‚
â”‚  â€¢ ç›®æ ‡é”šå®š  â€¢ å›¾éå†æ£€ç´¢  â€¢ æ‹“æ‰‘æ’åº  â€¢ G-P-Fç”Ÿæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAGå†…å®¹ç”Ÿæˆå™¨ + åŒæ™ºèƒ½ä½“è°ƒæ§å™¨                â”‚
â”‚  (rag_generator.py) + (dual_agent_controller.py)        â”‚
â”‚  â€¢ å›¾æ£€ç´¢  â€¢ æ–‡æœ¬æ£€ç´¢  â€¢ å†…å®¹ç”Ÿæˆ  â€¢ è·¯å¾„è°ƒæ§            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯æ®åŒ–æ—¥å¿—                              â”‚
â”‚                  (logger.py)                              â”‚
â”‚              â€¢ è·¯å¾„è®°å½•  â€¢ å†³ç­–è¿½è¸ª                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å‰ç½®è¦æ±‚

- Python 3.8+
- Neo4j 5.x
- Qwen APIå¯†é’¥ï¼ˆç”¨äºå¤§è¯­è¨€æ¨¡å‹å’Œå‘é‡æ¨¡å‹ï¼Œæ”¯æŒè‡ªè¡Œåˆ‡æ¢OpenAIï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»“åº“

```bash
git clone <repository-url>
cd shuang_agent
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹é…ç½®ï¼š

```python
# Neo4jé…ç½®
NEO4J_URI = "bolt://localhost:7687"
NEO4J_USER = "neo4j"
NEO4J_PASSWORD = "your_password"

# Qwen APIé…ç½®
DASHSCOPE_API_KEY = 'your_api_key'
```

### 4. åˆå§‹åŒ–ç›®å½•

```bash
python init_dirs.py
```

### 5. å‡†å¤‡æ•°æ®

å°†ä½ çš„æ•™å­¦ææ–™ï¼ˆè¯¾ç¨‹æ–‡æœ¬ã€æ•™æ¡ˆç­‰ï¼‰å¤„ç†ä¸ºJSONLæ ¼å¼ï¼Œä¿å­˜åˆ° `data/chunks.jsonl`ã€‚æ ¼å¼å¦‚ä¸‹ï¼š

```json
{"chunk_id": "chunk_1", "text": "æ•™å­¦å†…å®¹...", "module_hint": "æ¨¡å—å", "objective_hint": "å­¦ä¹ ç›®æ ‡", "source": "æ¥æº"}
```

### 6. è¿è¡Œç³»ç»Ÿ

#### å®Œæ•´æµç¨‹

```bash
python main.py
```

#### åˆ†æ­¥æ‰§è¡Œ

```bash
# æ„å»ºçŸ¥è¯†å›¾è°±
python main.py --step kg

# ç”Ÿæˆä»»åŠ¡é“¾
python main.py --step chain

# è¿è¡Œä»¿çœŸå®éªŒ
python main.py --step sim
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
shuang_agent/
â”œâ”€â”€ config.py                 # ç³»ç»Ÿé…ç½®
â”œâ”€â”€ data_processor.py         # æ•°æ®æ¥å…¥ä¸è¯­ä¹‰åˆ‡åˆ†
â”œâ”€â”€ kg_builder.py             # çŸ¥è¯†å›¾è°±æ„å»º
â”œâ”€â”€ task_chain_generator.py   # ä»»åŠ¡é“¾ç”Ÿæˆå™¨
â”œâ”€â”€ rag_generator.py          # RAGå†…å®¹ç”Ÿæˆå™¨
â”œâ”€â”€ dual_agent_controller.py  # åŒæ™ºèƒ½ä½“è°ƒæ§å™¨
â”œâ”€â”€ logger.py                 # è¯æ®åŒ–æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ simulation.py             # å¯¹è¯ä»¿çœŸå®éªŒ
â”œâ”€â”€ main.py                   # ä¸»ç¨‹åº
â”œâ”€â”€ utils/                    # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ api_client.py         # Qwen APIå®¢æˆ·ç«¯
â”‚   â””â”€â”€ embedder.py           # å‘é‡æ¨¡å‹å°è£…
â”œâ”€â”€ data/                     # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ chunks.jsonl          # æ–‡æœ¬å—æ•°æ®
â”‚   â”œâ”€â”€ kg_export/            # çŸ¥è¯†å›¾è°±å¯¼å‡º
â”‚   â”œâ”€â”€ task_chains/          # ä»»åŠ¡é“¾æ–‡ä»¶
â”‚   â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ simulation/           # ä»¿çœŸæ•°æ®
â””â”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### çŸ¥è¯†å›¾è°±æ„å»º

ç³»ç»Ÿæ”¯æŒ5ç±»èŠ‚ç‚¹å’Œ5ç±»å…³ç³»ï¼š

**èŠ‚ç‚¹ç±»å‹**ï¼š
- `Module`ï¼šæ•™å­¦æ¨¡å—
- `KnowledgePoint`ï¼šçŸ¥è¯†ç‚¹
- `CognitiveSkill`ï¼šè®¤çŸ¥æŠ€èƒ½
- `TeachingTask`ï¼šæ•™å­¦ä»»åŠ¡
- `TeachingActivity`ï¼šæ•™å­¦æ´»åŠ¨

**å…³ç³»ç±»å‹**ï¼š
- `BELONGS_TO_MODULE`ï¼šå±äºæ¨¡å—
- `SUPPORTS_UNDERSTANDING`ï¼šæ”¯æ’‘ç†è§£
- `CONSTITUTES_SKILL`ï¼šæ„æˆæŠ€èƒ½
- `PREDECESSOR_TASK`ï¼šå…ˆä¿®ä»»åŠ¡
- `DEPENDENT_TASK`ï¼šä¾èµ–ä»»åŠ¡

### ä»»åŠ¡é“¾ç”Ÿæˆ

åŸºäºçŸ¥è¯†å›¾è°±ç”Ÿæˆç»“æ„åŒ–çš„æ•™å­¦ä»»åŠ¡é“¾ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…å«ï¼š

- **Guidanceï¼ˆå¼•å¯¼ï¼‰**ï¼šæ¾„æ¸…ç›®æ ‡ã€æ¿€æ´»å…ˆå¤‡çŸ¥è¯†
- **Presentationï¼ˆè®²è§£ï¼‰**ï¼šè®²è§£å…³é”®æ¦‚å¿µã€æä¾›ç¤ºä¾‹
- **Feedbackï¼ˆåé¦ˆï¼‰**ï¼šæ£€æŸ¥ç†è§£ã€è¯†åˆ«åå·®

### åŒæ™ºèƒ½ä½“è°ƒæ§

**Guiding Agent**ï¼š
- æ’å…¥è¡¥æ¡¥èŠ‚ç‚¹ï¼Œå¡«è¡¥çŸ¥è¯†ç¼ºå£
- è§£é‡Šè½¬åœºå› æœï¼Œæ¢å¤å¯å­¦æ€§
- é€‚ç”¨äºçŸ¥è¯†è¯¯è§£å’Œè·³ä»»åŠ¡åœºæ™¯

**Structural Agent**ï¼š
- å›é€€ä¸»è·¯å¾„ï¼Œç¡®ä¿ç›®æ ‡æ¸…æ™°
- ç®€åŒ–æç¤ºï¼Œå‡å°‘å¤æ‚åº¦
- é€‚ç”¨äºç›®æ ‡å«ç³Šå’Œå¯¹è¯æ¼‚ç§»åœºæ™¯

## ğŸ“Š è¾“å‡ºæ–‡ä»¶

- `data/kg_export/nodes.csv`ï¼šçŸ¥è¯†å›¾è°±èŠ‚ç‚¹
- `data/kg_export/edges.csv`ï¼šçŸ¥è¯†å›¾è°±è¾¹
- `data/task_chains/*.json`ï¼šä»»åŠ¡é“¾æ–‡ä»¶
- `data/logs/path_log.jsonl`ï¼šè·¯å¾„è°ƒæ§æ—¥å¿—
- `data/simulation/*.json`ï¼šä»¿çœŸä¼šè¯æ•°æ®

## ğŸ”¬ å®éªŒè®¾è®¡

ç³»ç»Ÿæ”¯æŒæ‰¹é‡ä»¿çœŸå®éªŒï¼Œå®éªŒé…ç½®ï¼š

- **æ¨¡å—**ï¼š2ä¸ªï¼ˆMovement Systems, Health and Aerobic Training Designï¼‰
- **åœºæ™¯**ï¼š3ç§ï¼ˆambiguous, misunderstanding, cross-taskï¼‰
- **æ™ºèƒ½ä½“**ï¼š2ç§ï¼ˆguiding, structuralï¼‰
- **ä¼šè¯æ•°**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“50æ¬¡ï¼Œå…±100ä¸ªä¼šè¯

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### æ„å»ºçŸ¥è¯†å›¾è°±

```python
from kg_builder import KGBuilder
from data_processor import DataProcessor

# åŠ è½½chunks
processor = DataProcessor()
chunks = processor.load_chunks()

# æ„å»ºçŸ¥è¯†å›¾è°±
with KGBuilder() as kg_builder:
    kg_builder.build_from_chunks(chunks)
    kg_builder.export_graph()
```

### ç”Ÿæˆä»»åŠ¡é“¾

```python
from task_chain_generator import TaskChainGenerator

with TaskChainGenerator() as chain_gen:
    chain = chain_gen.generate_chain(
        target_objective="æŒæ¡è¿åŠ¨ç³»ç»Ÿçš„æ ¸å¿ƒå†…å®¹",
        learner_state={"level": "beginner"}
    )
    chain_gen.save_chain(chain, "output/chain.json")
```

### è¿è¡Œä»¿çœŸå®éªŒ

```python
from simulation import Simulation

sim = Simulation()
results = sim.simulate_session(
    module="Movement Systems",
    target_task="ç†è§£è¿åŠ¨ç³»ç»Ÿ",
    scenario_trigger="misunderstanding",
    agent_type="guiding"
)
```

## ğŸ› ï¸ å¼€å‘

### æ·»åŠ æ–°çš„èŠ‚ç‚¹ç±»å‹

1. åœ¨ `config.py` çš„ `NODE_TYPES` ä¸­æ·»åŠ 
2. æ›´æ–° `kg_builder.py` ä¸­çš„æŠ½å–é€»è¾‘

### è‡ªå®šä¹‰æ™ºèƒ½ä½“ç­–ç•¥

ç¼–è¾‘ `dual_agent_controller.py` ä¸­çš„promptå’Œé€»è¾‘ã€‚

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

- ä½¿ç”¨ [Qwen](https://github.com/QwenLM/Qwen) ä½œä¸ºå¤§è¯­è¨€æ¨¡å‹
- ä½¿ç”¨ [Neo4j](https://neo4j.com/) ä½œä¸ºå›¾æ•°æ®åº“
- ä½¿ç”¨ [LangChain](https://github.com/langchain-ai/langchain) è¿›è¡Œæ–‡æœ¬å¤„ç†

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼
